====== Firewall ======

===== Installation =====

  * Debian Linux: <cli>
# nft -v || apt install nftables
</cli>

===== Configuration =====

  - Set nftables((Nftables cheatsheet: https://wiki.nftables.org/wiki-nftables/index.php/Quick_reference-nftables_in_10_minutes.)) rules: <file txt /etc/nftables.conf>
#!/usr/bin/env nft -f

## Remove all previous firewall settings.
flush ruleset;

## Services on local machine.
define tcp_services = {22};
define udp_services = {68,546};

table inet fw {
  chain input {
    type filter hook input priority 0;
    policy drop;

    ## Accept all loopback traffic.
    ip saddr {127.0.0.0/8} accept;
    ip6 saddr {::1} accept;

    ## Accept ICMP traffic except for requests.
    icmp type != {8,13,15,17,30,42} accept;
    icmpv6 type != {128,144} accept;

    ## Accept responses from server.
    ct state {established,related} accept;

    ## Accept client requests only for specified TCP and UDP services.
    tcp dport $tcp_services accept;
    udp dport $udp_services accept;
  }
  chain output {
    type filter hook output priority 0;
    policy accept;

    ## Do not disclose closed UDP services exceptions.
    icmp type != {8,13,15,17,30,42} drop;
    icmpv6 type != {128,144} drop;

    ## Do not disclose closed TCP services exceptions.
    tcp sport $tcp_services tcp flags {rst} tcp sequence {0} ct state {established} drop;
  }
}
</file>

===== Service Management =====

  * List currently active firewall rules: <cli>
# nft list ruleset
</cli>

==== SystemD ====

  * Enable and start firewall rules: <cli>
# systemctl enable nftables
# systemctl start nftables
</cli>
  * Stop and disable firewall rules: <cli>
# systemctl stop nftables
# systemctl disable nftables
</cli>